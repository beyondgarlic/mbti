<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF--8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>의성 특산품 MBTI 테스트</title>
    <link rel="stylesheet" href="style.css">

    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-NXBRT3Z5');</script>
    </head>

<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NXBRT3Z5" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <div class="top-menu">
        <a href="https://beyondgarlic.github.io/garlicintro/" class="menu-link">
            <img src="images/BeyondGarlic.png" alt="메인 로고, 홈페이지 이동">
        </a>
        <a href="https://esmall.cyso.co.kr/" class="menu-link">
            <img src="images/shoppingmall.png" alt="쇼핑몰 이동">
        </a>

    </div>


    <div id="main-page" class="page">
        <h1>의성 특산품 MBTI</h1>
        <p>나의 MBTI를 통해 의성의 특산품 찾기!</p>
        <button id="start-btn">테스트 시작하기</button>
    </div>

    <div id="test-page" class="page hidden">
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
        <p id="progress-text"></p>

        <h2 id="question"></h2>
        <div class="options-container">
            <button class="option-btn" id="option-a"></button>
            <button class="option-btn" id="option-b"></button>
        </div>
    </div>

    <div id="result-page" class="page hidden">
        <h2 id="product-name"></h2>
        <img id="product-img" src="" alt="추천 캐릭터 이미지" />
        <p id="mbti-name"></p>
        <p id="mbti-desc"></p>

        <div id="product-desc" class="hashtags"></div>

        <div id="product-list" class="product-list"></div>


        <div class="share-container">
            <div class="share-title">친구에게 공유하기</div>
            <div class="share-circle">
                <button id="share-native" class="circle-btn" title="공유하기">
                    <img src="images/share_icon.png" alt="공유">
                </button>
                <a id="share-twitter" class="circle-btn" title="트위터" target="_blank">
                    <img src="images/x_icon.png" alt="트위터">
                </a>
                <a id="share-facebook" class="circle-btn" title="페이스북" target="_blank">
                    <img src="images/facebook_icon.png" alt="페이스북">
                </a>
                <button id="share-kakao" class="circle-btn" title="카카오톡">
                    <img src="images/kakaotalk_icon.png" alt="카카오톡">
                </button>
            </div>
        </div>

        <button id="restart-btn">다시하기</button>

        <p>
        <div id="disqus_thread"></div>
        <script>
            /**
            * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
            * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
            /*
            var disqus_config = function () {
            this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };
            */
            (function () { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                s.src = 'https://beyondgarlic-1.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by
                Disqus.</a></noscript>
        </p>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAO6xW1_NUYZUOe1pAqEv2C9a6uZmDD8cg",
            authDomain: "mbti-28340.firebaseapp.com",
            projectId: "mbti-28340",
            storageBucket: "mbti-28340.firebasestorage.app",
            messagingSenderId: "989371039709",
            appId: "1:989371039709:web:74ce719c718ad4a5ec8034",
            measurementId: "G-LL9LSER5V1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function trackVisitors() {
            // --- Firestore 문서 참조를 미리 정의 ---
            const totalRef = doc(db, "analytics", "totalPageViews");
            const uniqueRef = doc(db, "analytics", "uniquePageViews");

            // --- 1. 총 방문자 수(Page Views)는 항상 1 증가 ---
            // 페이지가 로드될 때마다 실행됩니다.
            try {
                await updateDoc(totalRef, { count: increment(1) });
            } catch (error) {
                // 문서가 없다면 (첫 실행), 1로 생성합니다.
                if (error.code === 'not-found') {
                    await setDoc(totalRef, { count: 1 });
                } else {
                    console.error("Error updating total views:", error);
                }
            }

            // --- 2. 순 방문자 수(Unique Visitors)는 처음 방문 시에만 증가 ---
            const hasVisited = localStorage.getItem('hasAlreadyVisited');
            if (!hasVisited) {
                localStorage.setItem('hasAlreadyVisited', 'true'); // 방문 도장 찍기
                try {
                    await updateDoc(uniqueRef, { count: increment(1) });
                } catch (error) {
                    // 문서가 없다면 (첫 순 방문자), 1로 생성합니다.
                    if (error.code === 'not-found') {
                        await setDoc(uniqueRef, { count: 1 });
                    } else {
                        console.error("Error updating unique views:", error);
                    }
                }
            }

            // --- 3. 두 데이터를 모두 가져와 화면에 표시 ---
            try {
                // Promise.all을 사용해 두 데이터를 동시에 요청
                const [totalSnap, uniqueSnap] = await Promise.all([
                    getDoc(totalRef),
                    getDoc(uniqueRef)
                ]);

                const totalEl = document.getElementById("totalVisitorCount");
                const uniqueEl = document.getElementById("uniqueVisitorCount");

                if (totalEl && totalSnap.exists()) {
                    totalEl.innerText = "총 방문: " + totalSnap.data().count;
                }
                if (uniqueEl && uniqueSnap.exists()) {
                    uniqueEl.innerText = "순 방문: " + uniqueSnap.data().count;
                }
            } catch (error) {
                console.error("Error displaying counts:", error);
            }
        }

        // 페이지 로드 시 함수 실행
        trackVisitors();
    </script>


    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js" crossorigin="anonymous"></script>
    <script>Kakao.init('9b771708b4454f04c4774684c6cfbe80');</script>
    <script src="script.js"></script>

</body>


</html>

